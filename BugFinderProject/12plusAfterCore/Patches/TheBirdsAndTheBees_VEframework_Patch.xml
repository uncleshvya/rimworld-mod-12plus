<?xml version="1.0" encoding="utf-8" ?>

<!-- MIT and CC BY-SA 4.0.
Copyright 2020 Fluffy
Копия лицензии - в файле TheBirdsAndTheBees_License_MIT_and_CC_BY_SA_4_0.txt.

CC BY-NC-ND 4.0
Copyright (c) Oskar Potocki
Копия лицензии - в файле VEframework_License_CC_BY_NC_ND_4_0_With_Exeption.txt -->

<Patch>
	<Operation MayRequire="fluffy.thebirdsandthebees" Class="PatchOperationSequence">
		<success>Always</success>
		<operations>

			<!-- Исправлена неточность, сообщите разработчику.

			Красные ошибки при старте игры. Есть решение с помощью мода-фикса, но он не скачивается через lttl. Выслано сообщение админу.
			Пока нет ответа, дописан сам оригинальный мод. Код предоставлен пользователем Proxyer -->
			<li Class="PatchOperationConditional">
				<xpath>*/BodyPartTagDef[defName = "FertilitySource"]</xpath>
				<nomatch Class="PatchOperationAdd">
					<xpath>/Defs</xpath>
					<value>
						<BodyPartTagDef>
							<defName>FertilitySource</defName>
							<vital>true</vital>
						</BodyPartTagDef>
					</value>
				</nomatch>
				<match Class="PatchOperationTest">
					<xpath>*/BodyPartTagDef[defName = "BloodFiltrationSource"]</xpath>
				</match>
			</li>

			<!-- Исправление согласно концепции «12+».

			Флаффи хардкодер. Не получается отключить его пытку-кастрацию у пленников. В качестве костыля, совместимого с сетевой игрой, используем особенность ванильного движка, когда нельзя ампутировать повреждённые или отличающиеся органы -->
			<li Class="PatchOperationAdd">
				<xpath>Defs</xpath>
				<value>
					<HediffDef>
						<defName>TBATB_DummyHediff</defName>
						<label>dummy hediff</label>
						<description>Should not be visible</description>
						<stages>
							<li>
								<becomeVisible>false</becomeVisible>
							</li>
						</stages>
						<scenarioCanAdd>false</scenarioCanAdd>
					</HediffDef>
				</value>
			</li>
			<li MayRequire="OskarPotocki.VanillaFactionsExpanded.Core" Class="PatchOperationAdd">
				<xpath>Defs/ThingDef[@Name = "BasePawn"]/comps</xpath>
				<value>
					<li Class="AnimalBehaviours.CompProperties_InitialHediff">
						<hediffname>TBATB_DummyHediff</hediffname>
					</li>
				</value>
			</li>

		</operations>
	</Operation>
</Patch>
