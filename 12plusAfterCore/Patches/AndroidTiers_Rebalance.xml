<?xml version="1.0" encoding="utf-8" ?>
<Patch>
	<Operation MayRequire="Atlas.AndroidTiers" Class="PatchOperationSequence">
		<success>Always</success>
		<operations>

			<!-- Исправлен баланс, сообщите разработчику

			Добавляем рецепт изготовления ножа для М7 и M8 -->
			<li Class="PatchOperationAdd">
				<xpath>Defs</xpath>
				<value>
					<RecipeDef>
						<defName>ATPP_Make_MeleeWeapon_MechKnife</defName>
						<label>make a Mech Blade</label>
						<description>Forge a two-meter plasteel blade and put a durable steel handle, suitable for huge "hand", on it.</description>
						<descriptionHyperlinks>
							<ThingDef>MeleeWeapon_MechKnife</ThingDef>
						</descriptionHyperlinks>
						<jobString>making a Mech Blade</jobString>
						<ingredients>
							<li>
								<filter>
									<thingDefs>
										<li>Plasteel</li>
									</thingDefs>
								</filter>
								<count>80</count>
							</li>
							<li>
								<filter>
									<thingDefs>
										<li>Steel</li>
									</thingDefs>
								</filter>
								<count>40</count>
							</li>
						</ingredients>
						<products>
							<MeleeWeapon_MechKnife>1</MeleeWeapon_MechKnife>
						</products>
						<workSpeedStat>GeneralLaborSpeed</workSpeedStat>
						<effectWorking>Cook</effectWorking>
						<soundWorking>Recipe_Machining</soundWorking>
						<workAmount>12000</workAmount>
						<unfinishedThingDef>UnfinishedComponent</unfinishedThingDef>
						<fixedIngredientFilter>
							<thingDefs>
								<li>Plasteel</li>
								<li>Steel</li>
							</thingDefs>
						</fixedIngredientFilter>
						<workSkill>Intellectual</workSkill>
						<skillRequirements>
							<Crafting>6</Crafting>
							<Intellectual>6</Intellectual>
						</skillRequirements>
						<researchPrerequisite>ATPP_ResearchSM7</researchPrerequisite>
						<recipeUsers>
							<li>AndroidPartsTable</li>
							<li>FueledSmithy</li>
							<li>ElectricSmithy</li>
						</recipeUsers>
					</RecipeDef>
				</value>
			</li>
			<!-- Добавляем рецепт разбивания андроидов на материалы для доиндустриальных поселений, по аналогии с ванилью -->
			<li Class="PatchOperationAdd">
				<xpath>Defs</xpath>
				<value>
					<RecipeDef>
						<defName>ATPP_SmashAndroid</defName>
						<label>smash body of android</label>
						<description>Smash a dead android with simple hand tools to salvage usable material.</description>
						<jobString>smashing android</jobString>
						<workAmount>450</workAmount>
						<workSpeedStat>ButcheryMechanoidSpeed</workSpeedStat>
						<workSkill>Crafting</workSkill>
						<efficiencyStat>ButcheryMechanoidEfficiency</efficiencyStat>
						<effectWorking>ButcherMechanoid</effectWorking>
						<uiIconThing>Plasteel</uiIconThing>
						<soundWorking>Recipe_SmashCorpseMechanoid</soundWorking>
						<ingredients>
							<li>
								<filter>
									<categories>
										<li>Corpses</li>
									</categories>
								</filter>
								<count>1</count>
							</li>
						</ingredients>
						<fixedIngredientFilter>
							<categories>
								<li>Corpses</li>
							</categories>
							<specialFiltersToDisallow>
								<li>AllowRotten</li>
							</specialFiltersToDisallow>
							<disallowedThingDefs>
								<!-- Трупы других органических рас следует добавлять сюда своими патчами, например как в файле OrassansLite_Patch.xml, причём обязательными, а не по желанию -->
								<li>Corpse_Human</li>
							</disallowedThingDefs>
							<!-- Эти строки в прошлых версиях убирали видимость списка, хотя кнопки "разрешить всё" и "запретить всё" по прежнему управляли невидимыми галочками. Оставить камент как инструкцию на случай нового рефакторинга кода -->
							<disallowedCategories>
								<li>CorpsesMechanoid</li>
								<li>CorpsesAnimal</li>
								<!-- <li>alienCorpseCategory</li> не сработало почему-то -->
							</disallowedCategories>
						</fixedIngredientFilter>
						<defaultIngredientFilter>
							<thingDefs>
								<li>Corpse_Android1Tier</li>
								<li>Corpse_Android2Tier</li>
								<li>Corpse_Android3Tier</li>
								<li>Corpse_Android4Tier</li>
								<li>Corpse_Android5Tier</li>
								<li>Corpse_M7Mech</li>
								<li>Corpse_M8Mech</li>
							</thingDefs>
							<specialFiltersToAllow>
								<li>AllowCorpsesColonist</li>
								<li>AllowCorpsesStranger</li>
								<li>AllowCorpsesSlave</li>
							</specialFiltersToAllow>
						</defaultIngredientFilter>
						<specialProducts>
							<li>Butchery</li>
						</specialProducts>
						<recipeUsers>
							<li>CraftingSpot</li>
						</recipeUsers>
					</RecipeDef>
				</value>
			</li>
			<!-- У андроидов М7 и M8 убрана возможность общения, иначе они могут торговаться и вести переговоры, а это противоречит лору.
			Ещё они шутят, переживают, обсуждают социальные взаимодействия и т.п. Автор частично обошёл этот баг, отключив им слух - теперь M7 и M8 не являются инициаторами общения. Но всё ещё поддерживают разговор -->
			<li Class="PatchOperationAdd">
				<xpath>Defs/AlienRace.BackstoryDef[
				defName = "MechanizedInfantry" or
				defName = "AndroidTier_PrototypeM8"
				]/workDisables</xpath>
				<value>
					<li>Social</li>
				</value>
			</li>
			<!-- На данном этапе развития мода АТ, питательный раствор - это не животный продукт. Корректируем категорию -->
			<li Class="PatchOperationReplace">
				<xpath>Defs/ThingDef[defName = "NSolution"]/thingCategories/li[1]/text()</xpath>
				<value>Foods</value>
			</li>
			<!-- Автор сделал робо-корову отдельной ветвью кода, из-за чего сгенерировался новый вид мяса. Это даёт простор для творчества.
			Перекрашиваем мясо под новый лор, расположенный в описании питомца -->
			<li Class="PatchOperationAdd">
				<xpath>Defs/ThingDef[defName = "RoboticCow"]/race</xpath>
				<value>
					<meatColor>(102, 225, 255)</meatColor>
				</value>
			</li>
			<!-- Мяса делаем вполовину меньше, чем у живой коровы, чисто по объёму брюха -->
			<li Class="PatchOperationReplace">
				<xpath>Defs/ThingDef[defName = "RoboticCow"]/statBases/MeatAmount/text()</xpath>
				<value>70</value>
			</li>

		</operations>
	</Operation>
</Patch>
