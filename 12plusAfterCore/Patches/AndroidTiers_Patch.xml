<?xml version="1.0" encoding="utf-8" ?>
<Patch>
	<Operation MayRequire="Atlas.AndroidTiers" Class="PatchOperationSequence">
		<success>Always</success>
		<operations>

			<!-- Исправлена неточность, сообщите разработчику.

			У андроидов M7 и M8 нет кнопки "Персона", хотя в описании персонажа "i" эта вкладка работает. Но у мёртвых кнопка снова появляется! Надо или вернуть её живым, или убрать у мёртвых.
			Дополнительная информация по навыкам - в файле AndroidTiers_Rebalance.xml.
			Виден навык "Животноводство" у покойных M7 и M8, а в описании персонажа отображаются лишние характеристики "Скорость поглощения пищи", "Шансы на приручение/обучение животных", "Качество/Скорость лечения", "Эффективность жатвы", "Скорость работы с растениями", "Эффективность/Скорость работы с животными", "Скорость переплавки", "Качество ремонта андроидов".
			Пока не найдено решение для этих багов, хотя бы сгладим явное несоответствие по животноводству в панели "Персона" у мёртвого M7: -->
			<li Class="PatchOperationAdd">
				<xpath>Defs/TraitDef[defName = "MechAtlas"]/degreeDatas/li[1]</xpath>
				<value>
					<skillGains>
						<li>
							<key>Animals</key>
							<value>-20</value>
						</li>
					</skillGains>
				</value>
			</li>

			<!-- Возраст андроидов и механоидов не может быть больше 3400 лет.
			Ещё более вероятно, что все 7 моделей андроидов изобрели в одно время с механоидами.
			Действующий же алгоритм приводил к появлению отрицательных дат рождения  -->
			<li Class="PatchOperationAdd">
				<xpath>Defs/PawnKindDef[
				defName = "AndroidT5Colonist" or
				defName = "M7MechPawn" or
				defName = "M8MechPawn"
				]</xpath>
				<value>
					<maxGenerationAge>2500</maxGenerationAge>
				</value>
			</li>

			<!-- Возраст только что созданных андроидов должен быть равен 0, а не 5. Решение пока не найдено, нужно сделать отсчёт возраста от нуля, как у только что рождённых детёнышей животных.
			Стандартное решение приводит к ошибке. Пробовал выставить натуральное число, тоже не помогло:
			<li Class="PatchOperationReplace">
				<xpath>Defs/PawnKindDef[
				defName = "AndroidT1Colonist" or
				defName = "AndroidT2Colonist" or
				defName = "AndroidT3Colonist" or
				defName = "AndroidT4Colonist"
				]/maxGenerationAge/text()</xpath>
				<value>0</value>
			</li>
			Для M7 это тоже актуально, а там возможно надо будет создать отдельный PawnKindDef для суррогатов.

			Андроиды из пластали не могут заржаветь. Более вероятна запылённость суставов и других движущихся частей. Цвет описания подправлен соответственно. -->
			<li Class="PatchOperationReplace">
				<xpath>Defs/HediffDef[defName = "ATPP_Rusted"]/defaultLabelColor/text()</xpath>
				<value>(255, 255, 255)</value>
			</li>

			<!-- Тип мяса отображается даже при его нулевом количестве.
			В лоре из книги Ф.К.Дика "Снятся ли андроидам электроовцы" не описана биохимия потребления пищи у андроидов, но косвенно можно понять, что она близка к человеческой.
			Вероятно, в них встроен биореактор, как у биороботов из вселенной "Кремль 2222".
			Было бы правильно заменить "мясо альпака" у андроидов на наше "мумиё".
			Но так как внешность андроидов нарисована не по лору, а ближе к роботам, то более логичным ресурсом будет сталь как в трупах механоидов -->
			<li Class="PatchOperationReplace">
				<xpath>Defs/AlienRace.ThingDef_AlienRace[
				defName = "Android1Tier" or
				defName = "Android2Tier" or
				defName = "Android3Tier" or
				defName = "Android4Tier" or
				defName = "Android5Tier" or
				defName = "M7Mech" or
				defName = "M8Mech"
				]/race/useMeatFrom/text()</xpath>
				<value>Mech_Centipede</value>
			</li>
			<!-- Аналогично для дрона и 4 механических питомцев -->
			<li Class="PatchOperationReplace">
				<xpath>Defs/ThingDef[
				defName = "MicroScyther" or
				@Name = "AnimalAndroidThingBase"
				]/race/useMeatFrom/text()</xpath>
				<value>Mech_Centipede</value>
			</li>
			<!-- Для механической коровы: -->
			<li Class="PatchOperationAdd">
				<xpath>Defs/ThingDef[defName = "RoboticCow"]/race</xpath>
				<value>
					<useMeatFrom>Mech_Centipede</useMeatFrom>
				</value>
			</li>

			<!-- Тип кожи тоже отображается даже при её нулевом количестве.
			У всех 7 андроидов отключена ранее прописанная шкура мутанта -->
			<li Class="PatchOperationReplace">
				<xpath>Defs/AlienRace.ThingDef_AlienRace[
				defName = "Android1Tier" or
				defName = "Android2Tier" or
				defName = "Android3Tier" or
				defName = "Android4Tier" or
				defName = "Android5Tier" or
				defName = "M7Mech" or
				defName = "M8Mech"
				]/race/leatherDef</xpath>
				<value>
					<useLeatherFrom>Mech_Centipede</useLeatherFrom>
				</value>
			</li>
			<!-- Аналогично для дрона -->
			<li Class="PatchOperationReplace">
				<xpath>Defs/ThingDef[defName = "MicroScyther"]/race/leatherDef</xpath>
				<value>
					<useLeatherFrom>Mech_Centipede</useLeatherFrom>
				</value>
			</li>
			<!-- Аналогично для 5 механических питомцев.
			Кроме того, на данном этапе развития мода АТ, все робо-животные - металлические машины, поэтому не могут быть целью хищников -->
			<li Class="PatchOperationReplace">
				<xpath>Defs/ThingDef[
				defName = "AndroidMuff" or
				defName = "AndroidChicken" or
				defName = "RoboticSheep" or
				defName = "AndroidDog" or
				defName = "RoboticCow"
				]/race/leatherDef</xpath>
				<value>
					<useLeatherFrom>Mech_Centipede</useLeatherFrom>
					<canBePredatorPrey>false</canBePredatorPrey>
				</value>
			</li>

			<!-- Убираем кости у андроидов из мода Rim of Madness - Bones -->
			<li MayRequire="sihv.rombones" Class="PatchOperationAdd">
				<xpath>Defs/AlienRace.ThingDef_AlienRace[
				defName = "Android1Tier" or
				defName = "Android2Tier" or
				defName = "Android3Tier" or
				defName = "Android4Tier" or
				defName = "Android5Tier"
				]/statBases</xpath>
				<value>
					<BoneAmount>0</BoneAmount>
				</value>
			</li>
			<!-- Аналогично для M7, M8, дрона и 5-и механических питомцев -->
			<li MayRequire="sihv.rombones" Class="PatchOperationAdd">
				<xpath>Defs/ThingDef[
				@Name = "AnimalAndroidThingBase" or
				@Name = "BasePawnMech" or
				defName = "RoboticCow"
				]/statBases</xpath>
				<value>
					<BoneAmount>0</BoneAmount>
				</value>
			</li>

			<!-- Доделываем скрытую фракцию мутантов.
			Использованы фракталы из книги "Парк юрского периода".
			Цвет подобран, чтобы соответствовать внешнему виду мутанта -->
			<li MayRequire="Ludeon.RimWorld.Ideology" Class="PatchOperationAdd">
				<xpath>Defs/FactionDef[defName = "Abomination"]</xpath>
				<value>
					<factionIconPath>UI/Ideoligions/Universal/CirclesC</factionIconPath>
					<colorSpectrum> <li>(143, 114, 156)</li> </colorSpectrum>
				</value>
			</li>

			<!-- Исправление согласно концепции «12+».

			Убираем разделку бывших людей -->
			<li Class="PatchOperationAdd">
			<!-- Внимание! При добавлении нового общего параметра важен алфавитный порядок файлов патчей! В следущих за этим файлах не надо создавать disallowedThingDefs, только ссылаться на него.
			Кроме того, файл с созданной переменной disallowedThingDefs должен относиться к действующему моду -->
				<xpath>Defs/RecipeDef[defName = "ButcherCorpseFlesh"]/fixedIngredientFilter</xpath>
				<value>
					<disallowedThingDefs>
						<li>Corpse_Abomination</li>
					</disallowedThingDefs>
				</value>
			</li>
			<li Class="PatchOperationReplace">
				<xpath>Defs/ThingDef[defName = "Abomination"]/statBases/MeatAmount</xpath>
				<value>
					<MeatAmount>0</MeatAmount>
					<BoneAmount MayRequire="sihv.rombones">0</BoneAmount>
				</value>
			</li>
			<li Class="PatchOperationReplace">
				<xpath>Defs/ThingDef[defName = "Abomination"]/statBases/LeatherAmount/text()</xpath>
				<value>0</value>
			</li>

			<!-- Андроиды, 7 видов -->
			<li Class="PatchOperationAdd">
				<xpath>Defs/AlienRace.ThingDef_AlienRace[
				defName = "Android1Tier" or
				defName = "Android2Tier" or
				defName = "Android3Tier" or
				defName = "Android4Tier" or
				defName = "Android5Tier" or
				defName = "M7Mech" or
				defName = "M8Mech"
				]/alienRace/generalSettings/disallowedTraits</xpath>
				<value>
					<li> <defName>Asexual</defName> </li>
					<li> <defName>Bisexual</defName> </li>
					<li> <defName>Cannibal</defName> </li>
					<li> <defName>Gay</defName> </li>
					<!-- Masochist уже отключен у всех 7.
					Pyromaniac уже отключен у всех кроме T5 -->
				</value>
			</li>
			<!-- T5 больше не пироман -->
			<li Class="PatchOperationAdd">
				<xpath>Defs/AlienRace.ThingDef_AlienRace[defName = "Android5Tier"]/alienRace/generalSettings/disallowedTraits</xpath>
				<value>
					<li> <defName>Pyromaniac</defName> </li>
				</value>
			</li>
			<!-- У M7 и M8 уже отключены все мысли параметром cannotReceiveThoughtsAtAll.
			У T5 уже отключены мысли ButcheredHumanlikeCorpse и KnowButcheredHumanlikeCorpse -->
			<li Class="PatchOperationAdd">
				<xpath>Defs/AlienRace.ThingDef_AlienRace[defName = "Android5Tier"]/alienRace/thoughtSettings/cannotReceiveThoughts</xpath>
				<value>
					<li>HarvestedOrgan_Bloodlust</li>
					<li>KilledHumanlikeBloodlust</li>
					<li>MasochistPain</li>
					<li>PyromaniacHappy</li>
					<li>WitnessedDeathBloodlust</li>
				</value>
			</li>
			<li Class="PatchOperationAdd">
				<xpath>Defs/AlienRace.ThingDef_AlienRace[
				defName = "Android1Tier" or
				defName = "Android2Tier" or
				defName = "Android3Tier" or
				defName = "Android4Tier"
				]/alienRace/thoughtSettings/cannotReceiveThoughts</xpath>
				<value>
					<li>ButcheredHumanlikeCorpse</li>
					<li>HarvestedOrgan_Bloodlust</li>
					<li>KilledHumanlikeBloodlust</li>
					<li>KnowButcheredHumanlikeCorpse</li>
					<li>MasochistPain</li>
					<li>PyromaniacHappy</li>
					<li>WitnessedDeathBloodlust</li>
				</value>
			</li>
			<!-- Для трейтов из мода VanillaExpanded.VanillaTraitsExpanded изменения внесены в его файле VEtraits_Patch.xml.

			Для замены разделки исправляем недоделанный автором рецепт разборки андроидов. -->
			<li Class="PatchOperationReplace">
				<xpath>Defs/RecipeDef[defName = "ATPP_DisassembleAndroid"]/ingredients/li[1]/filter/categories/li[1]/text()</xpath>
				<value>Corpses</value>
			</li>
			<li Class="PatchOperationReplace">
				<xpath>Defs/RecipeDef[defName = "ATPP_DisassembleAndroid"]/fixedIngredientFilter</xpath>
				<value>
					<uiIconThing>Steel</uiIconThing>
					<fixedIngredientFilter>
						<categories>
							<li>Corpses</li>
						</categories>
						<disallowedCategories>
							<li>CorpsesMechanoid</li>
							<li>CorpsesAnimal</li>
						</disallowedCategories>
					</fixedIngredientFilter>
				</value>
			</li>

			<!-- Убираем съедобность мёртвого мутанта и дрона. Почему-то из этого файла она не отключается, вероятно из-за алфавитного порядка файлов патчей. Решено методом переноса нужных строк в файл "ManEatingPatch.xml".
			<li Class="PatchOperationAdd">
				<xpath>Defs/ThingDef[@Name = "BasePawn"]/race/willNeverEat</xpath>
				<value>
					<li>Corpse_Abomination</li>
					<li>Corpse_MicroScyther</li>
				</value>
			</li>
			-->

			<!-- Скрипт MOARANDROIDS.Recipe_RerollTraits. использует все трейты, вместо разрешённых для конкретной расы.
			Кроме того, он добавляет черты характера даже андроидам без личности.
			Пока не найдено решение для этих багов, рецепт мягко отключён -->
			<li Class="PatchOperationReplace">
				<xpath>Defs/RecipeDef[defName = "RerollAndroidTraits"]/workerClass/text()</xpath>
				<value>MOARANDROIDS.Recipe_AndroidRewireSurgery</value>
			</li>

		</operations>
	</Operation>
</Patch>
